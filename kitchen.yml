---
driver:
  name: vagrant

provisioner:
  name: chef_zero
  product_name: chef
  product_version: <%= ENV['chef_release'] %>
  deprecations_as_errors: true
  chef_license: accept-no-persist
  download_url: http://10.1.1.30/media/chef-<%= ENV['chef_release'] %>-1.el7.x86_64.rpm

verifier:
  name: inspec

platforms:
- name: mycentos7

suites:
  - name: checkmks
    driver:
      vm_hostname: <%= ENV['CMK_NAME'] %>
      network:
      - ["private_network", {ip: "<%= ENV['CMK_IP'] %>"}]
      customize:
        memory: <%= ENV['CMK_RAM'] %>
        cpus: <%= ENV['CMK_CPU'] %>
        name: <%= ENV['CMK_NAME'] %>
    run_list:
      - recipe[checkmk::server]
      - recipe[checkmk::add_host]
    verifier:
      inspec_tests:
        - test/integration/default
    attributes:
      server_ip: <%= ENV['CMK_IP'] %>

  - name: checkmka
    driver:
      vm_hostname: checkmka
      network:
      - ["private_network", {ip: "10.1.1.102"}]
      customize:
        memory: <%= ENV['WEB_RAM'] %>
        cpus: <%= ENV['CMK_CPU'] %>
        name: checkmka
    run_list:
      - recipe[checkmk::agent-cmk]
    verifier:
      inspec_tests:
        - test/integration/default
    attributes:
      server_ip: <%= ENV['CMK_IP'] %>
